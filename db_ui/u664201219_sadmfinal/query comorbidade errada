select
	GROUP_CONCAT(DISTINCT\n IF(`lista_doenca_diretrizes`.`descricao_tipo` LIKE 'Comorbidade', \n IF(`ref_doencas_cids_teste2`.`subcategoria` IS NOT NULL, \n CONCAT(`ref_doencas_cids_teste2`.`subcategoria`, " - ", `ref_doencas_cids_teste2`.`descricao_subcategoria`), \n CONCAT(`ref_doencas_cids_teste2`.`categoria`, ' - ', `ref_doencas_cids_teste2`.`descricao_categoria`)\n ), \n NULL\n )\n ) as "comorbidade",
	GROUP_CONCAT(DISTINCT\n IF(`lista_doenca_diretrizes`.`descricao_tipo` NOT LIKE 'Comorbidade', \n IF(`ref_doencas_cids_teste2`.`subcategoria` IS NOT NULL, \n CONCAT(`ref_doencas_cids_teste2`.`subcategoria`, " - ", `ref_doencas_cids_teste2`.`descricao_subcategoria`), \n CONCAT(`ref_doencas_cids_teste2`.`categoria`, ' - ', `ref_doencas_cids_teste2`.`descricao_categoria`)\n ), \n NULL\n )\n ) as "doenca_principal"
from
	`ref_doencas_cids_teste2`
left join estatus_diretrizes_data_has_diretrizes on
	estatus_diretrizes_data_has_diretrizes.diretrizes_cod_diretrizes = ref_doencas_cids_teste2.cod_diretrizes
left join estatus_controle_diretrizes on
estatus_controle_diretrizes.cod_estatus_controle_diretrizes = estatus_diretrizes_data_has_diretrizes.estatus_controle_diretrizes_cod_estatus_controle_diretrizes
left join lista_doenca_diretrizes on
lista_doenca_diretrizes.diretrizes_cod_diretrizes = ref_doencas_cids_teste2.cod_diretrizes

where
	(`ref_doencas_cids_teste2`.`cod_diretrizes` in (
select
		`cod_diretrizes`
from
		`ref_doencas_cids_teste2`
where
		(`ref_doencas_cids_teste2`.`descricao` = "Hipertensão arterial"
		and `ref_doencas_cids_teste2`.`descricao_tipo` = "Doença Principal"))
and `estatus_controle_diretrizes`.`cod_estatus_controle_diretrizes` < 10)
group by
	`ref_doencas_cids_teste2`.`cod_diretrizes`
